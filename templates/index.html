<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KODV ê°€ë­„ ì·¨ì•½ì„± ì§€ë„</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ’§</text></svg>">

    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <style>
        body { margin: 0; padding: 0; overflow: hidden; font-family: 'Pretendard', sans-serif; }
        #map { height: 100vh; width: 100%; z-index: 1; background: #eaebef; }
        
        .search-container { position: absolute; top: 30px; left: 50%; transform: translateX(-50%); z-index: 1000; width: 90%; max-width: 650px; display: flex; gap: 10px; }
        .search-box { flex-grow: 1; }
        
        #ai-result-panel {
            position: absolute; top: 100px; right: 20px; z-index: 1000;
            width: 380px; max-height: 80vh; overflow-y: auto;
            background: rgba(255, 255, 255, 0.95); border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: none; padding: 20px; backdrop-filter: blur(5px);
        }

        #loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2000; display: none; background: rgba(255, 255, 255, 0.95); border-radius: 15px; box-shadow: 0 0 20px rgba(0,0,0,0.2); }
        #zoom-badge { position: absolute; bottom: 30px; right: 30px; z-index: 1000; background: rgba(33, 37, 41, 0.85); color: white; padding: 8px 16px; border-radius: 30px; font-size: 0.9rem; backdrop-filter: blur(4px); }
        .leaflet-interactive { outline: none; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; border: 1px solid #dee2e6; white-space: pre-wrap; word-break: break-all; }
        
        .table-custom th { background-color: #f1f3f5; }
        .table-custom td { vertical-align: middle; }
        
        /* ì½˜ì†” ìŠ¤íƒ€ì¼ */
        .console-textarea { background-color: #1e1e1e; color: #d4d4d4; font-family: 'Consolas', monospace; border: none; resize: vertical; }
        .console-textarea:focus { background-color: #1e1e1e; color: #fff; box-shadow: none; border: 1px solid #007bff; }

        /* ì „ë¬¸ê°€ ì½˜ì†” íƒ­ ìŠ¤íƒ€ì¼ë§ */
        #consoleTab .nav-link {
            color: #6c757d; /* ê¸°ë³¸: íšŒìƒ‰ */
            font-weight: 600;
        }
        #consoleTab .nav-link.active {
            color: #0d6efd !important; /* í™œì„±: íŒŒë€ìƒ‰ */
            background-color: #fff;
            border-color: #dee2e6 #dee2e6 #fff;
        }
        #consoleTab .nav-link:hover {
            color: #0a58ca;
        }

        /* [UX Fix Final v2] í–‰(Row) í˜¸ë²„ ë„ê¸° & ì…€(Cell) ë‹¨ë… í˜¸ë²„ (ìš°ì„ ìˆœìœ„ ìˆ˜ì •ë¨) */

        /* 1. ë¶€íŠ¸ìŠ¤íŠ¸ë©ì˜ ê¸°ë³¸ 'ì¤„ ì „ì²´ ìƒ‰ì¹ ' ê¸°ëŠ¥ì„ ë•ë‹ˆë‹¤ */
        .table-custom.table-hover tbody tr:hover > * {
            --bs-table-accent-bg: transparent !important;
            background-color: transparent !important;
            box-shadow: none !important;
        }

        /* 2. ë§ˆìš°ìŠ¤ê°€ ì˜¬ë¼ê°„ 'ê·¸ ì¹¸(td)'ë§Œ íšŒìƒ‰ìœ¼ë¡œ ë³€í•˜ê²Œ í•©ë‹ˆë‹¤ */
        /* ì¤‘ìš”: ìœ„ 1ë²ˆ ê·œì¹™ë³´ë‹¤ ìš°ì„ ìˆœìœ„ë¥¼ ë†’ì´ê¸° ìœ„í•´ ì„ íƒìë¥¼ ê¸¸ê²Œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤ */
        .table-custom.table-hover tbody tr td:hover {
            background-color: rgba(0, 0, 0, 0.075) !important; /* íšŒìƒ‰ ì ìš© */
            transition: background-color 0.1s;
        }

        /* 3. ë¶„ë¥˜ ì…€(rowspan)ë„ ì´ì œ ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ íšŒìƒ‰ì´ ë©ë‹ˆë‹¤ (ë‹¨ë… ë™ì‘) */
        .table-custom tbody td[rowspan] {
            background-color: #fff; /* í‰ì†Œì—” í°ìƒ‰ */
        }

        /* ë¦¬í”Œë › íŒì—… ë„ˆë¹„ ì œí•œ í•´ì œ (L3 ë”ë¸” íŒ¨ë„ìš©) */
        .leaflet-popup-content-wrapper {
            border-radius: 12px; /* ë‘¥ê¸€ê²Œ */
            padding: 0; /* íŒ¨ë”© ì œê±° (ë‚´ë¶€ì—ì„œ ì¡°ì ˆ) */
            overflow: hidden;
        }
        .leaflet-popup-content {
            margin: 0;
            width: auto !important; /* ë‚´ìš©ë¬¼ì— ë§ì¶° ëŠ˜ì–´ë‚˜ê²Œ */
            max-width: 800px !important; /* ì¶©ë¶„íˆ ë„“ê²Œ */
        }
        /* [UI Fix] íŒì—… ë‹«ê¸° ë²„íŠ¼(X) ìŠ¤íƒ€ì¼ ê°œì„  */
        .leaflet-popup-close-button {
            width: 30px !important;
            height: 30px !important;
            line-height: 30px !important;
            border-radius: 50%; /* ì›í˜• */
            background: white !important; /* ë°°ê²½ í°ìƒ‰ */
            box-shadow: 0 2px 6px rgba(0,0,0,0.2); /* ê·¸ë¦¼ì */
            color: #555 !important;
            font-size: 18px !important;
            top: -10px !important;  /* íŒì—… ë°”ê¹¥ìª½ ìœ„ë¡œ ì‚´ì§ ëºŒ */
            right: -10px !important; /* íŒì—… ë°”ê¹¥ìª½ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì‚´ì§ ëºŒ */
            text-align: center;
            z-index: 2000; /* ì œì¼ ìœ„ì— í‘œì‹œ */
            transition: all 0.2s;
            text-decoration: none !important;
        }
        .leaflet-popup-close-button:hover {
            background: #f8f9fa !important;
            color: #dc3545 !important; /* í˜¸ë²„ ì‹œ ë¹¨ê°„ìƒ‰ */
            transform: scale(1.1);
        }
        
        /* íŒì—… ì»¨í…ì¸  ë‘¥ê¸€ê¸° ë° ì˜¤ë²„í”Œë¡œìš° í•´ì œ (Xë²„íŠ¼ì´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë ¤ë©´ í•„ìš”) */
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            padding: 0;
            overflow: visible !important; /* Xë²„íŠ¼ì´ ë°–ìœ¼ë¡œ ë‚˜ê°ˆ ìˆ˜ ìˆê²Œ */
        }
        .leaflet-popup-content {
            margin: 0;
            width: auto !important;
            max-width: 800px !important;
            border-radius: 12px;
            overflow: hidden; /* ë‚´ë¶€ ì»¨í…ì¸ ëŠ” ë‘¥ê¸€ê²Œ ì˜ë¦¼ */
        }

        /* [ì»¤ìŠ¤í…€ ë“±ê¸‰ ìƒ‰ìƒ] */
        .text-orange { color: #fd7e14 !important; }
        .bg-orange { background-color: #fd7e14 !important; color: white; }
        .border-orange { border-color: #fd7e14 !important; }

        .text-dark-red { color: #8B0000 !important; }
        .bg-dark-red { background-color: #8B0000 !important; color: white; }
        .border-dark-red { border-color: #8B0000 !important; }
    </style>
</head>
<body>

    <div id="loading" class="p-4 text-center">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
        <div class="mt-3 fw-bold text-dark fs-5">ë°ì´í„° ë¡œë”© ì¤‘...</div>
    </div>

    <div id="zoom-badge"><i class="fa-solid fa-layer-group me-2"></i><span id="level-name">ê´‘ì—­ (ì‹œë„)</span></div>

    <div class="search-container">
        <div class="input-group shadow-lg rounded-pill overflow-hidden search-box">
            <span class="input-group-text bg-white border-0 ps-4"><i class="fa-solid fa-robot text-primary"></i></span>
            <input type="text" class="form-control border-0 p-3" placeholder="ì˜ˆ: ì „ë¶ì—ì„œ ìƒí™œìš©ìˆ˜ ì´ìš©ëŸ‰ì´ ê°€ì¥ ë§ì€ ê³³ì€?" id="searchInput" onkeypress="handleEnter(event)">
            <button class="btn btn-primary px-4 fw-bold" onclick="askAI()">ê²€ìƒ‰</button>
        </div>
        
        <button class="btn btn-light shadow-lg rounded-circle" style="width: 58px; height: 58px;" onclick="showHelpModal()" title="ì‚¬ìš© ê°€ëŠ¥í•œ ë°ì´í„° ëª©ë¡">
            <i class="fa-solid fa-circle-question fa-xl text-secondary"></i>
        </button>
        
        <button class="btn btn-dark shadow-lg rounded-circle" style="width: 58px; height: 58px;" onclick="showConsoleModal()" title="ì „ë¬¸ê°€ìš© SPARQL ì½˜ì†”">
            <i class="fa-solid fa-terminal fa-xl text-white"></i>
        </button>
    </div>

    <div id="ai-result-panel">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="fw-bold m-0"><i class="fa-solid fa-sparkles text-warning me-2"></i>AI ê²€ìƒ‰ ê²°ê³¼</h5>
            <button class="btn btn-sm btn-light rounded-circle" onclick="$('#ai-result-panel').hide()"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div id="ai-content"></div>
    </div>

    <div class="modal fade" id="sparqlModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title"><i class="fa-solid fa-code me-2"></i>ìƒì„±ëœ SPARQL ì¿¼ë¦¬</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body"><pre><code id="sparql-code" class="text-primary fw-bold"></code></pre></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="helpModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-light">
                <h5 class="modal-title fw-bold"><i class="fa-solid fa-database text-primary me-2"></i>ì‚¬ìš© ê°€ëŠ¥í•œ ê°€ë­„ ë°ì´í„° ëª©ë¡
                    (ì´ 19ì¢…)</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0">

                <div class="alert alert-primary m-3 border-0 small">
                    <h6 class="fw-bold mb-2"><i class="fa-solid fa-circle-info me-2"></i>AI ì˜ë¯¸ ê²€ìƒ‰ í™œìš© ê°€ì´ë“œ</h6>

                    <div class="mb-3">
                        <strong>âœ… ê¸°ëŠ¥: ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ì§ˆë¬¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</strong>
                        <ul class="list-unstyled ps-2 mt-1 mb-0">
                            <li class="mb-2">
                                <span class="badge bg-primary bg-opacity-10 text-primary border border-primary me-1">ì§€ì—­
                                    ê²€ìƒ‰ (Highlight)</span>
                                "ì¶©ë‚¨ì—ì„œ <strong>ì¸êµ¬</strong>ê°€ 3ë§Œ ëª…ì„ ë„˜ëŠ” ê³³ì€?"<br>
                                "ì „êµ­ì—ì„œ <strong>ê¸‰ìˆ˜ìœ¨</strong>ì´ ë‚®ì€ ì§€ì—­ í•˜ìœ„<strong> 20ê³³</strong>ì„ ì•Œë ¤ì¤˜"
                                <br><span class="text-muted ms-1" style="font-size: 0.9em;">â†’ ì¡°ê±´ì— ë§ëŠ” ìë©´ë™ ì§€ì—­ì„ ì§€ë„ì—
                                    í‘œì‹œí•©ë‹ˆë‹¤.</span>
                            </li>
                            <li>
                                <span class="badge bg-success bg-opacity-10 text-success border border-success me-1">í†µê³„
                                    ì¡°íšŒ (Value)</span>
                                "ì„œìš¸ì˜ <strong>í‰ê·  ì·¨ì•½ì„± ë“±ê¸‰</strong>ì€?"
                                <br><span class="text-muted ms-1" style="font-size: 0.9em;">â†’ AIê°€ ìµœí•˜ìœ„ ì§€ì—­ ë°ì´í„°ë¥¼ ì§‘ê³„(í‰ê· , í•©ê³„
                                    ë“±)í•˜ì—¬ ê°’ì„ ì•Œë ¤ì¤ë‹ˆë‹¤.</span>
                            </li>
                        </ul>
                    </div>

                    <div class="mb-0 pt-2 border-top border-primary border-opacity-25">
                        <strong>âš ï¸ ì§ˆë¬¸ ì‘ì„± íŒ (ì •í™•í•œ ë¶„ì„ì„ ìœ„í•´ í•„ìˆ˜!)</strong>
                        <ul class="mb-0 ps-3">
                            <li class="mb-1">
                                <strong>ì§€ì—­ ë²”ìœ„ì™€ ê°œìˆ˜ í¬í•¨í•˜ê¸°:</strong> ë°ì´í„° ì–‘ì´ ë§ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ <strong>"10 ê³³", "ìƒìœ„ 30ê°œ"</strong> ì²˜ëŸ¼ ê°œìˆ˜ë¥¼ ì œí•œí•˜ê³  <strong>"~ì—ì„œ"</strong>ë¼ëŠ”
                                ë²”ìœ„ë¥¼ ëª…ì‹œí•´ ì£¼ì„¸ìš”.
                            </li>
                            <li>
                                <strong>ì •í™•í•œ ëª…ì¹­ ì‚¬ìš©:</strong> ì•„ë˜ í‘œì˜ <strong>'ë°ì´í„° í•­ëª©(êµµì€ ê¸€ì”¨)'</strong> ì´ë¦„ì„ í¬í•¨í•´ì•¼ Aiê°€ <strong>RAG(Retrieval-Augmented
                                    Generation)</strong>ê¸°ë°˜ì˜ ê²€ìƒ‰ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="table-responsive" style="max-height: 60vh;">
                    <table class="table table-hover table-bordered mb-0 small table-custom">
                        <thead class="table-light sticky-top">
                            <tr class="text-center">
                                <th style="width: 15%">ë¶„ë¥˜</th>
                                <th style="width: 35%">ë°ì´í„° í•­ëª© (í‚¤ì›Œë“œ)</th>
                                <th>ì„¤ëª…</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td rowspan="3" class="text-center bg-white fw-bold text-secondary">ê¸‰ìˆ˜ ì¸êµ¬ ì •ë³´</td>
                                <td><strong>ì¸êµ¬</strong></td>
                                <td>í–‰ì •êµ¬ì—­ ë‚´ ê±°ì£¼ ì¸êµ¬ìˆ˜</td>
                            </tr>
                            <tr>
                                <td><strong>ê¸‰ìˆ˜ìœ¨</strong></td>
                                <td>ìƒìˆ˜ë„ ë³´ê¸‰ ë¹„ìœ¨ (%)</td>
                            </tr>
                            <tr>
                                <td><strong>ê¸‰ìˆ˜ì¸êµ¬</strong></td>
                                <td>ì‹¤ì œ ìƒìˆ˜ë„ë¥¼ ê³µê¸‰ë°›ëŠ” ì¸êµ¬</td>
                            </tr>
                            <tr>
                                <td rowspan="4" class="text-center bg-white fw-bold text-secondary">ë…¸ì¶œë„</td>
                                <td><strong>í‰ê·  ê°€ë­„ ì‹¬ë„</strong></td>
                                <td>ê¸°ìƒí•™ì  ê°€ë­„ì˜ í‰ê·  ì‹¬ê°ë„</td>
                            </tr>
                            <tr>
                                <td><strong>ê°€ë­„ ë°œìƒ ë¹ˆë„</strong></td>
                                <td>ê³¼ê±° ê°€ë­„ ë°œìƒ íšŸìˆ˜</td>
                            </tr>
                            <tr>
                                <td><strong>ê°€ë­„ ë…¸ì¶œë„</strong></td>
                                <td>ì‹¬ë„ì™€ ë¹ˆë„ë¥¼ ì¢…í•©í•œ ì ìˆ˜</td>
                            </tr>
                            <tr>
                                <td><strong>ë…¸ì¶œë„ ê³„ìˆ˜</strong></td>
                                <td>ë…¸ì¶œë„ ì ìˆ˜ì˜ í‘œì¤€í™” ê³„ìˆ˜</td>
                            </tr>
                            <tr>
                                <td rowspan="4" class="text-center bg-white fw-bold text-secondary">ë¯¼ê°ë„</td>
                                <td><strong>ìƒí™œìš©ìˆ˜ ì´ìš©ëŸ‰</strong></td>
                                <td>ê°€ì • ë“± ì¼ìƒìƒí™œ ë¬¼ ì‚¬ìš©ëŸ‰</td>
                            </tr>
                            <tr>
                                <td><strong>ê³µì—…ìš©ìˆ˜ ì´ìš©ëŸ‰</strong></td>
                                <td>ì‚°ì—…/ê³µì¥ìš© ë¬¼ ì‚¬ìš©ëŸ‰</td>
                            </tr>
                            <tr>
                                <td><strong>ìƒÂ·ê³µìš©ìˆ˜ ì´ìš©ëŸ‰</strong></td>
                                <td>ìƒí™œìš©ìˆ˜ + ê³µì—…ìš©ìˆ˜ í•©ê³„</td>
                            </tr>
                            <tr>
                                <td><strong>ë¯¼ê°ë„ ê³„ìˆ˜</strong></td>
                                <td>ìˆ˜ìš” ê¸°ë°˜ í”¼í•´ ê°€ëŠ¥ì„± ê³„ìˆ˜</td>
                            </tr>
                            <tr>
                                <td rowspan="4" class="text-center bg-white fw-bold text-secondary">ë³´ì¡°ìˆ˜ì›</td>
                                <td><strong>ì €ìˆ˜ì§€ ìœ íš¨ ì €ìˆ˜ëŸ‰</strong></td>
                                <td>ì‚¬ìš© ê°€ëŠ¥í•œ ì €ìˆ˜ì§€ ë¬¼ì˜ ì–‘</td>
                            </tr>
                            <tr>
                                <td><strong>ì§€í•˜ìˆ˜ ê°œë°œ ê°€ëŠ¥ëŸ‰</strong></td>
                                <td>ì´ìš© ê°€ëŠ¥í•œ ì§€í•˜ìˆ˜ ì´ëŸ‰</td>
                            </tr>
                            <tr>
                                <td><strong>ë³´ì¡°ìˆ˜ì› ëŠ¥ë ¥</strong></td>
                                <td>ë¹„ìƒì‹œ ë¬¼ ê³µê¸‰ ì ì¬ë ¥</td>
                            </tr>
                            <tr>
                                <td><strong>ë³´ì¡°ìˆ˜ì› ê³„ìˆ˜</strong></td>
                                <td>ë³´ì¡°ìˆ˜ì› ëŠ¥ë ¥ì˜ í‘œì¤€í™” ê³„ìˆ˜</td>
                            </tr>
                            <tr>
                                <td rowspan="2" class="text-center bg-white fw-bold text-secondary">ëŒ€ì‘ ëŠ¥ë ¥</td>
                                <td><strong>ìš©ìˆ˜ê³µê¸‰ ê°€ëŠ¥ì¼ìˆ˜</strong></td>
                                <td>ë¬¼ ê³µê¸‰ ì§€ì† ê°€ëŠ¥ ì˜ˆìƒ ì¼ìˆ˜</td>
                            </tr>
                            <tr>
                                <td><strong>ëŒ€ì‘ëŠ¥ë ¥ ê³„ìˆ˜</strong></td>
                                <td>ê°€ë­„ ëŒ€ì‘ ì—­ëŸ‰ í‘œì¤€í™” ê³„ìˆ˜</td>
                            </tr>
                            <tr>
                                <td rowspan="2" class="text-center bg-white fw-bold text-danger">ì·¨ì•½ì„±</td>
                                <td><strong>ì·¨ì•½ì„± ì ìˆ˜</strong></td>
                                <td>ì¢…í•© ê°€ë­„ ì·¨ì•½ì„± ì ìˆ˜</td>
                            </tr>
                            <tr>
                                <td><strong>ì·¨ì•½ì„± ë“±ê¸‰</strong></td>
                                <td>1(ê´€ì‹¬) ~ 5(ë§¤ìš°ì‹¬ê°) ë“±ê¸‰</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-secondary w-100" data-bs-dismiss="modal">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
    </div>

<div class="modal fade" id="consoleModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title d-flex align-items-center">
                        <i class="fa-solid fa-terminal me-2 text-success"></i>SPARQL Expert Console
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body bg-light p-0">
                    <ul class="nav nav-tabs nav-fill bg-white border-bottom" id="consoleTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="query-tab" data-bs-toggle="tab" data-bs-target="#query-panel" type="button" role="tab">
                                <i class="fa-solid fa-code me-2"></i>Query Editor
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="vocab-tab" data-bs-toggle="tab" data-bs-target="#vocab-panel" type="button" role="tab">
                                <i class="fa-solid fa-book me-2"></i>Vocabulary Dictionary
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="ttl-tab" data-bs-toggle="tab" data-bs-target="#ttl-panel" type="button" role="tab">
                                <i class="fa-solid fa-file-code me-2"></i>Full Knowledge Graph (TTL)
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content p-3" id="consoleTabContent">
                        
                        <div class="tab-pane fade show active" id="query-panel" role="tabpanel">
                            
                            <div class="alert alert-secondary py-2 px-3 mb-2 small">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>
                                        <i class="fa-solid fa-circle-check text-success me-2"></i><strong>Prefix ìë™ ì ìš©ë¨:</strong> kodv, koad, rdfs, skos, etc.
                                    </span>
                                    <button class="btn btn-sm btn-outline-dark" type="button" data-bs-toggle="collapse" data-bs-target="#prefixCollapse" aria-expanded="false">
                                        <i class="fa-solid fa-list me-1"></i>Prefix ëª©ë¡ ë³´ê¸°
                                    </button>
                                </div>
                                
                                <div class="collapse mt-2" id="prefixCollapse">
                                    <div class="card card-body bg-white border p-0 overflow-hidden">
                                        <table class="table table-sm table-striped mb-0 table-bordered" style="font-size: 0.85rem;">
                                            <thead class="table-light">
                                                <tr>
                                                    <th style="width: 15%" class="text-center">Prefix</th>
                                                    <th>Namespace URI</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr><td class="text-center fw-bold">kodv</td><td class="font-monospace text-muted">&lt;https://knowledgemap.kr/kodv/def/&gt;</td></tr>
                                                <tr><td class="text-center fw-bold">kodvid</td><td class="font-monospace text-muted">&lt;https://knowledgemap.kr/kodv/id/&gt;</td></tr>
                                                <tr><td class="text-center fw-bold">koad</td><td class="font-monospace text-muted">&lt;http://vocab.datahub.kr/def/administrative-division/&gt;</td></tr>
                                                <tr><td class="text-center fw-bold">rdfs</td><td class="font-monospace text-muted">&lt;http://www.w3.org/2000/01/rdf-schema#&gt;</td></tr>
                                                <tr><td class="text-center fw-bold">skos</td><td class="font-monospace text-muted">&lt;http://www.w3.org/2004/02/skos/core#&gt;</td></tr>
                                                <tr><td class="text-center fw-bold">qudt</td><td class="font-monospace text-muted">&lt;http://qudt.org/schema/qudt/&gt;</td></tr>
                                                <tr><td class="text-center fw-bold">unit</td><td class="font-monospace text-muted">&lt;http://qudt.org/vocab/unit/&gt;</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <div class="d-flex justify-content-end mb-1">
                                    <span class="badge bg-danger me-1"><i class="fa-solid fa-ban me-1"></i>DELETE/UPDATE ê¸ˆì§€</span>
                                    <span class="badge bg-success"><i class="fa-solid fa-check me-1"></i>SELECT í—ˆìš©</span>
                                </div>
                                
                                <textarea id="console-input" class="form-control console-textarea p-3 font-monospace" rows="10" spellcheck="false" 
                                style="background-color: #1e1e1e; color: #d4d4d4; border: 1px solid #333; font-size: 0.95rem;">
SELECT ?name ?pop
WHERE {
  ?s a koad:Dong ;
     rdfs:label ?name ;
     kodv:population ?pop .
}
ORDER BY DESC(?pop)
LIMIT 5</textarea>
                            </div>

                            <button class="btn btn-primary w-100 fw-bold py-2 shadow-sm" onclick="runConsoleQuery()">
                                <i class="fa-solid fa-play me-2"></i> ì¿¼ë¦¬ ì‹¤í–‰ (Execute)
                            </button>
                            
                            <hr class="my-4">
                            
                            <label class="form-label fw-bold"><i class="fa-solid fa-table me-2"></i>ì‹¤í–‰ ê²°ê³¼ (Result)</label>
                            <div class="table-responsive bg-white border rounded" style="max-height: 250px; min-height: 100px;">
                                <table class="table table-sm table-hover table-striped mb-0 small" id="console-result-table">
                                    <thead class="table-light sticky-top"><tr><th class="p-3 text-center text-muted">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</th></tr></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="vocab-panel" role="tabpanel">
                            <div class="alert alert-info py-2 small mb-2">
                                <i class="fa-solid fa-info-circle me-2"></i>KODV í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©ëœ ëª¨ë“  ì–´íœ˜ ë° ë§¤í•‘ ì •ë³´ì…ë‹ˆë‹¤.
                            </div>
                            <div class="table-responsive border rounded bg-white shadow-sm" style="height: 600px; overflow-y: auto;">
                                <table class="table table-hover table-bordered mb-0 small">
                                    <thead class="table-light sticky-top">
                                        <tr class="text-center">
                                            <th style="width: 12%">ìœ í˜•</th>
                                            <th style="width: 30%">ì–´íœ˜ (Vocabulary)</th>
                                            <th style="width: 18%">í•­ëª©ëª… (Label)</th>
                                            <th>ì„¤ëª… (Description)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="table-secondary">
                                            <td colspan="4" class="fw-bold ps-3">1. í–‰ì •êµ¬ì—­ í‘œì¤€ í´ë˜ìŠ¤ (koad)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-primary">Class</span></td>
                                            <td class="font-monospace text-primary">koad:SpecialMetropolitanCity</td>
                                            <td>íŠ¹ë³„ì‹œ</td>
                                            <td>ì„œìš¸</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-primary">Class</span></td>
                                            <td class="font-monospace text-primary">koad:MetropolitanCity</td>
                                            <td>ê´‘ì—­ì‹œ</td>
                                            <td>ë¶€ì‚°, ì¸ì²œ ë“±</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-primary">Class</span></td>
                                            <td class="font-monospace text-primary">koad:SpecialSelfGoverningCity</td>
                                            <td>íŠ¹ë³„ìì¹˜ì‹œ</td>
                                            <td>ì„¸ì¢…</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-primary">Class</span></td>
                                            <td class="font-monospace text-primary">koad:Province</td>
                                            <td>ë„</td>
                                            <td>ê²½ê¸°, ê°•ì› ë“±</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-primary">Class</span></td>
                                            <td class="font-monospace text-primary">koad:SpecialSelfGoverningProvince</td>
                                            <td>íŠ¹ë³„ìì¹˜ë„</td>
                                            <td>ì œì£¼, ê°•ì›</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-primary">Class</span></td>
                                            <td class="font-monospace text-primary">koad:AdministrativeCity</td>
                                            <td>í–‰ì •ì‹œ</td>
                                            <td>ì œì£¼ì‹œ, ì„œê·€í¬ì‹œ ë“±</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-primary">Class</span></td>
                                            <td class="font-monospace text-primary">koad:SpecialCity</td>
                                            <td>íŠ¹ë¡€ì‹œ</td>
                                            <td>ìˆ˜ì›, ìš©ì¸ ë“±</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-primary">Class</span></td>
                                            <td class="font-monospace text-primary">koad:City</td>
                                            <td>ì‹œ</td>
                                            <td>ì¼ë°˜ ì‹œ</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-primary">Class</span></td>
                                            <td class="font-monospace text-primary">koad:County</td>
                                            <td>êµ°</td>
                                            <td>êµ° ì§€ì—­</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-primary">Class</span></td>
                                            <td class="font-monospace text-primary">koad:District</td>
                                            <td>êµ¬ (ìì¹˜êµ¬)</td>
                                            <td>íŠ¹ë³„ì‹œ/ê´‘ì—­ì‹œ ì‚°í•˜</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-primary">Class</span></td>
                                            <td class="font-monospace text-primary">koad:NonAutonomousDistrict</td>
                                            <td>êµ¬ (í–‰ì •êµ¬)</td>
                                            <td>ìˆ˜ì› íŒ”ë‹¬êµ¬ ë“±</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-primary">Class</span></td>
                                            <td class="font-monospace text-primary">koad:Eup</td>
                                            <td>ì (í–‰ì •ì)</td>
                                            <td>í•˜ìœ„ í–‰ì •êµ¬ì—­</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-primary">Class</span></td>
                                            <td class="font-monospace text-primary">koad:Myeon</td>
                                            <td>ë©´ (í–‰ì •ë©´)</td>
                                            <td>í•˜ìœ„ í–‰ì •êµ¬ì—­</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-primary">Class</span></td>
                                            <td class="font-monospace text-primary">koad:Dong</td>
                                            <td>ë™ (í–‰ì •ë™)</td>
                                            <td>í•˜ìœ„ í–‰ì •êµ¬ì—­</td>
                                        </tr>
                                        
                                        <tr class="table-secondary">
                                            <td colspan="4" class="fw-bold ps-3">2. í–‰ì •êµ¬ì—­ ë°ì´í„° ì†ì„± ë° ê´€ê³„ (koad)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-secondary">Annotation</span></td>
                                            <td class="font-monospace text-dark">rdfs:label</td>
                                            <td>ì‹œë„ëª…/ì‹œêµ°ëª…/ìë©´ë™ëª…</td>
                                            <td>ì‚¬ëŒì´ ì½ì„ ìˆ˜ ìˆëŠ” ëª…ì¹­</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">koad:divisionCode</td>
                                            <td>í–‰ì •êµ¬ì—­ì½”ë“œ</td>
                                            <td>Unique ID (String)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Obj Prop (Up)</span></td>
                                            <td class="font-monospace text-dark">koad:isCityOf</td>
                                            <td>(ê´€ê³„) ~ì— ì†í•œ ì‹œ</td>
                                            <td>ê¸°ì´ˆ -> ê´‘ì—­ (ì—­ê´€ê³„)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Obj Prop (Up)</span></td>
                                            <td class="font-monospace text-dark">koad:isCountyOf</td>
                                            <td>(ê´€ê³„) ~ì— ì†í•œ êµ°</td>
                                            <td>ê¸°ì´ˆ -> ê´‘ì—­ (ì—­ê´€ê³„)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Obj Prop (Up)</span></td>
                                            <td class="font-monospace text-dark">koad:isDistrictOf</td>
                                            <td>(ê´€ê³„) ~ì— ì†í•œ êµ¬</td>
                                            <td>ê¸°ì´ˆ -> ê´‘ì—­ (ì—­ê´€ê³„)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Obj Prop (Up)</span></td>
                                            <td class="font-monospace text-dark">koad:isTownOf</td>
                                            <td>(ê´€ê³„) ~ì— ì†í•œ ì</td>
                                            <td>í•˜ìœ„ -> ê¸°ì´ˆ (ì—­ê´€ê³„)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Obj Prop (Up)</span></td>
                                            <td class="font-monospace text-dark">koad:isTownshipOf</td>
                                            <td>(ê´€ê³„) ~ì— ì†í•œ ë©´</td>
                                            <td>í•˜ìœ„ -> ê¸°ì´ˆ (ì—­ê´€ê³„)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Obj Prop (Up)</span></td>
                                            <td class="font-monospace text-dark">koad:isNeighborhoodOf</td>
                                            <td>(ê´€ê³„) ~ì— ì†í•œ ë™</td>
                                            <td>í•˜ìœ„ -> ê¸°ì´ˆ (ì—­ê´€ê³„)</td>
                                        </tr>
                                        
                                        <tr class="table-secondary">
                                            <td colspan="4" class="fw-bold ps-3">3. ê°€ë­„ ë°ì´í„° ì†ì„± (kodv - L3 ì „ìš©)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:population</td>
                                            <td>ì¸êµ¬</td>
                                            <td>ê±°ì£¼ ì´ ì¸êµ¬ìˆ˜</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:waterSupplyRate</td>
                                            <td>ê¸‰ìˆ˜ìœ¨</td>
                                            <td>ìƒìˆ˜ë„ ë³´ê¸‰ë¥ (%)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:waterSupplyPopulation</td>
                                            <td>ê¸‰ìˆ˜ì¸êµ¬</td>
                                            <td>ìƒìˆ˜ë„ ê³µê¸‰ ì¸êµ¬</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:droughtSeverityAvg</td>
                                            <td>í‰ê· ê°€ë­„ì‹¬ë„</td>
                                            <td>ê¸°ìƒí•™ì  ê°€ë­„ì§€ìˆ˜(SPI) í‰ê· </td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:droughtFrequency</td>
                                            <td>ê°€ë­„ë°œìƒë¹ˆë„</td>
                                            <td>ê³¼ê±° ê°€ë­„ ë°œìƒ íšŸìˆ˜</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:droughtExposureScore</td>
                                            <td>ê°€ë­„ë…¸ì¶œë„</td>
                                            <td>ì‹¬ë„+ë¹ˆë„ ì¢…í•© ì ìˆ˜</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:exposureCoefficient</td>
                                            <td>ë…¸ì¶œë„ê³„ìˆ˜</td>
                                            <td>ë…¸ì¶œë„ í‘œì¤€í™” ê³„ìˆ˜</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:domesticWaterUsage</td>
                                            <td>ìƒí™œìš©ìˆ˜ì´ìš©ëŸ‰</td>
                                            <td>ê°€ì • ë“± ì¼ìƒìƒí™œ ìš©ìˆ˜ëŸ‰</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:industrialWaterUsage</td>
                                            <td>ê³µì—…ìš©ìˆ˜ì´ìš©ëŸ‰</td>
                                            <td>ì‚°ì—… ìƒì‚° í™œë™ ìš©ìˆ˜ëŸ‰</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:sensitivityCoefficient</td>
                                            <td>ë¯¼ê°ë„ ê³„ìˆ˜</td>
                                            <td>í”¼í•´ ê°€ëŠ¥ì„± í‘œì¤€í™” ê³„ìˆ˜</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:reservoirCapacity</td>
                                            <td>ì €ìˆ˜ì§€ ìœ íš¨ì €ìˆ˜ëŸ‰</td>
                                            <td>ê´€ê°œ/ìš©ìˆ˜ ê³µê¸‰ ê°€ëŠ¥ëŸ‰</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:groundwaterAvailable</td>
                                            <td>ì§€í•˜ìˆ˜ ê°œë°œê°€ëŠ¥ëŸ‰</td>
                                            <td>ì§€ì† ì´ìš© ê°€ëŠ¥í•œ ì§€í•˜ìˆ˜ëŸ‰</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:domesticIndustrialWaterUsage</td>
                                            <td>ìƒÂ·ê³µìš©ìˆ˜ ì´ìš©ëŸ‰</td>
                                            <td>ìƒí™œ+ê³µì—… ìš©ìˆ˜ í•©ê³„</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:auxWaterSourceCapacity</td>
                                            <td>ë³´ì¡°ìˆ˜ì›ëŠ¥ë ¥</td>
                                            <td>ë¹„ìƒì‹œ ë¬¼ ê³µê¸‰ ì ì¬ë ¥</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:auxWaterSourceCoefficient</td>
                                            <td>ë³´ì¡°ìˆ˜ì›ê³„ìˆ˜</td>
                                            <td>ë³´ì¡°ìˆ˜ì›ëŠ¥ë ¥ í‘œì¤€í™” ê³„ìˆ˜</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:waterSupplyAvailableDays</td>
                                            <td>ìš©ìˆ˜ê³µê¸‰ ê°€ëŠ¥ì¼ìˆ˜</td>
                                            <td>ê°€ìš© ìˆ˜ìì› ì§€ì† ì¼ìˆ˜</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:responseCapacityCoefficient</td>
                                            <td>ëŒ€ì‘ëŠ¥ë ¥ê³„ìˆ˜</td>
                                            <td>ê°€ë­„ ëŒ€ì‘ ì—­ëŸ‰ í‘œì¤€í™” ê³„ìˆ˜</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:vulnerabilityScore</td>
                                            <td>ì·¨ì•½ì„±</td>
                                            <td>ìµœì¢… ê°€ë­„ ì·¨ì•½ì„± ì ìˆ˜</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Obj Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:vulnerabilityRating</td>
                                            <td>ì·¨ì•½ì„±ë“±ê¸‰ (URI)</td>
                                            <td>I~V ë“±ê¸‰ ê°œë… ì—°ê²°</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-info text-dark">Data Prop</span></td>
                                            <td class="font-monospace text-dark">kodv:vulnerabilityRatingNumeric</td>
                                            <td>ì·¨ì•½ì„± ë“±ê¸‰ (ìˆ«ì)</td>
                                            <td>1~5 ì •ìˆ˜ (ì •ë ¬/ë¹„êµ ì¿¼ë¦¬ìš©)</td>
                                        </tr>
                                        
                                        <tr class="table-secondary">
                                            <td colspan="4" class="fw-bold ps-3">4. SKOS í‘œì¤€ ì–´íœ˜ (ë¶„ë¥˜ ì²´ê³„ ì •ì˜ìš©)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-primary">Class</span></td>
                                            <td class="font-monospace text-primary">skos:Concept</td>
                                            <td>ê°œë… (Concept)</td>
                                            <td>ì§€ì‹ ë¶„ë¥˜ì˜ ê°œë³„ ì•„ì´ë””ì–´</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-primary">Class</span></td>
                                            <td class="font-monospace text-primary">skos:ConceptScheme</td>
                                            <td>ê°œë… ë¶„ë¥˜ ì²´ê³„</td>
                                            <td>ê°œë…ë“¤ì˜ ì§‘í•©(ìŠ¤í‚¤ë§ˆ)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-primary">Class</span></td>
                                            <td class="font-monospace text-primary">skos:OrderedCollection</td>
                                            <td>ìˆœì„œìˆëŠ” ì§‘í•©</td>
                                            <td>ìˆœì„œê°€ ì •ì˜ëœ ê°œë… ëª¨ìŒ</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-secondary">Annotation</span></td>
                                            <td class="font-monospace text-dark">skos:prefLabel</td>
                                            <td>ëŒ€í‘œ ì´ë¦„</td>
                                            <td>ê°œë…ì˜ ê³µì‹ ëª…ì¹­</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-secondary">Annotation</span></td>
                                            <td class="font-monospace text-dark">skos:definition</td>
                                            <td>ê°œë… ì •ì˜</td>
                                            <td>ê°œë…ì˜ ëœ» í’€ì´</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-secondary">Annotation</span></td>
                                            <td class="font-monospace text-dark">skos:altLabel</td>
                                            <td>ëŒ€ì²´ ì´ë¦„</td>
                                            <td>ë™ì˜ì–´ ë˜ëŠ” ë³„ì¹­</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Obj Prop</span></td>
                                            <td class="font-monospace text-dark">skos:hasTopConcept</td>
                                            <td>(ê´€ê³„) ìµœìƒìœ„ ê°œë…ì„ ê°€ì§</td>
                                            <td>ìŠ¤í‚¤ë§ˆì™€ ìµœìƒìœ„ ê°œë… ì—°ê²°</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Obj Prop</span></td>
                                            <td class="font-monospace text-dark">skos:inScheme</td>
                                            <td>(ê´€ê³„) ë¶„ë¥˜í‘œì— ì†í•¨</td>
                                            <td>ê°œë…ì´ ì†í•œ ìŠ¤í‚¤ë§ˆ ëª…ì‹œ</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Obj Prop</span></td>
                                            <td class="font-monospace text-dark">skos:memberList</td>
                                            <td>(ê´€ê³„) ë©¤ë²„ ëª©ë¡</td>
                                            <td>ì»¬ë ‰ì…˜ì˜ ìˆœì„œ ì •ì˜ ë¦¬ìŠ¤íŠ¸</td>
                                        </tr>
                                        
                                        <tr class="table-secondary">
                                            <td colspan="4" class="fw-bold ps-3">5. KODV ì˜¨í†¨ë¡œì§€ ë¶„ë¥˜ ì²´ê³„ (kodvid)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Instance</span></td>
                                            <td class="font-monospace">kodvid:droughtVulnerability</td>
                                            <td>ê°€ë­„ ì§€í‘œ ë¶„ë¥˜</td>
                                            <td>Concept Scheme (ì „ì²´ ë¶„ë¥˜)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Instance</span></td>
                                            <td class="font-monospace">kodvid:WaterSupplyInfo</td>
                                            <td>ê¸‰ìˆ˜ ì¸êµ¬ ì •ë³´</td>
                                            <td>Top Concept</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Instance</span></td>
                                            <td class="font-monospace">kodvid:Exposure</td>
                                            <td>ë…¸ì¶œë„ í‰ê°€ê²°ê³¼</td>
                                            <td>Top Concept</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Instance</span></td>
                                            <td class="font-monospace">kodvid:Sensitivity</td>
                                            <td>ë¯¼ê°ë„ í‰ê°€ê²°ê³¼</td>
                                            <td>Top Concept</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Instance</span></td>
                                            <td class="font-monospace">kodvid:AuxWaterSource</td>
                                            <td>ë³´ì¡°ìˆ˜ì›ëŠ¥ë ¥ í‰ê°€ê²°ê³¼</td>
                                            <td>Top Concept</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Instance</span></td>
                                            <td class="font-monospace">kodvid:ResponseCapacity</td>
                                            <td>ê°€ë­„ëŒ€ì‘ëŠ¥ë ¥ í‰ê°€ê²°ê³¼</td>
                                            <td>Top Concept</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Instance</span></td>
                                            <td class="font-monospace">kodvid:Vulnerability</td>
                                            <td>ê°€ë­„ì·¨ì•½ì„± í‰ê°€ê²°ê³¼</td>
                                            <td>Top Concept</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Instance</span></td>
                                            <td class="font-monospace">kodvid:RatingScale</td>
                                            <td>ì·¨ì•½ì„± ë“±ê¸‰ ì²™ë„</td>
                                            <td>Ordered Collection (5ë‹¨ê³„)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Instance</span></td>
                                            <td class="font-monospace">kodvid:Rating_I</td>
                                            <td>I ë“±ê¸‰ (ê´€ì‹¬)</td>
                                            <td>Concept (ì·¨ì•½ì„± ë“±ê¸‰)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Instance</span></td>
                                            <td class="font-monospace">kodvid:Rating_II</td>
                                            <td>II ë“±ê¸‰ (ì£¼ì˜)</td>
                                            <td>Concept (ì·¨ì•½ì„± ë“±ê¸‰)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Instance</span></td>
                                            <td class="font-monospace">kodvid:Rating_III</td>
                                            <td>III ë“±ê¸‰ (ê²½ê³„)</td>
                                            <td>Concept (ì·¨ì•½ì„± ë“±ê¸‰)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Instance</span></td>
                                            <td class="font-monospace">kodvid:Rating_IV</td>
                                            <td>IV ë“±ê¸‰ (ì‹¬ê°)</td>
                                            <td>Concept (ì·¨ì•½ì„± ë“±ê¸‰)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Instance</span></td>
                                            <td class="font-monospace">kodvid:Rating_V</td>
                                            <td>V ë“±ê¸‰ (ë§¤ìš°ì‹¬ê°)</td>
                                            <td>Concept (ì·¨ì•½ì„± ë“±ê¸‰)</td>
                                        </tr>
                                        
                                        <tr class="table-secondary">
                                            <td colspan="4" class="fw-bold ps-3">6. ì™¸ë¶€ í‘œì¤€ ì–´íœ˜ (Schema, DC, XSD, QUDT, OWL)</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-secondary">Annotation</span></td>
                                            <td class="font-monospace text-dark">schema:unitText</td>
                                            <td>ë‹¨ìœ„ í…ìŠ¤íŠ¸</td>
                                            <td>ì‚¬ëŒì´ ë³´ëŠ” ë‹¨ìœ„ í‘œì‹œ</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-secondary">Annotation</span></td>
                                            <td class="font-monospace text-dark">dcterms:title</td>
                                            <td>ì œëª© (Title)</td>
                                            <td>ìŠ¤í‚¤ë§ˆ ê³µì‹ ëª…ì¹­</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-secondary">Annotation</span></td>
                                            <td class="font-monospace text-dark">dcterms:description</td>
                                            <td>ì„¤ëª… (Description)</td>
                                            <td>ìƒì„¸ ì„¤ëª…</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Obj Prop</span></td>
                                            <td class="font-monospace text-dark">dcterms:subject</td>
                                            <td>ì£¼ì œ (Subject)</td>
                                            <td>ì†ì„±ê³¼ ê°œë… ì—°ê²°</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-secondary">Annotation</span></td>
                                            <td class="font-monospace text-dark">rdfs:comment</td>
                                            <td>ì£¼ì„ (Comment)</td>
                                            <td>ë¶€ê°€ ì„¤ëª…</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Obj Prop</span></td>
                                            <td class="font-monospace text-dark">rdfs:range</td>
                                            <td>ê°’ì˜ ë²”ìœ„ (Range)</td>
                                            <td>ì†ì„± ê°’ì˜ íƒ€ì… ì •ì˜</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-danger">Datatype</span></td>
                                            <td class="font-monospace text-dark">xsd:string</td>
                                            <td>(íƒ€ì…) ë¬¸ìì—´</td>
                                            <td>Text í˜•ì‹ ê°’</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-danger">Datatype</span></td>
                                            <td class="font-monospace text-dark">xsd:integer</td>
                                            <td>(íƒ€ì…) ì •ìˆ˜</td>
                                            <td>ì†Œìˆ˜ì  ì—†ëŠ” ìˆ«ì</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-danger">Datatype</span></td>
                                            <td class="font-monospace text-dark">xsd:decimal</td>
                                            <td>(íƒ€ì…) ì‹¤ìˆ˜</td>
                                            <td>ì†Œìˆ˜ì  í¬í•¨ ìˆ«ì</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Obj Prop</span></td>
                                            <td class="font-monospace text-dark">qudt:hasQuantityKind</td>
                                            <td>ë¬¼ë¦¬ëŸ‰ ì¢…ë¥˜</td>
                                            <td>ë°ì´í„°ì˜ ë¬¼ë¦¬ì  ì°¨ì›</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Obj Prop</span></td>
                                            <td class="font-monospace text-dark">qudt:unit</td>
                                            <td>ì¸¡ì • ë‹¨ìœ„</td>
                                            <td>ë°ì´í„°ì˜ ë‹¨ìœ„ ì—°ê²°</td>
                                        </tr>
                                        <tr>
                                            <td><span class="badge bg-warning text-dark">Obj Prop</span></td>
                                            <td class="font-monospace text-dark">owl:sameAs</td>
                                            <td>ë™ì¼ ê°œì²´</td>
                                            <td>ë‹¤ë¥¸ URIì™€ ë™ì¼í•¨ ëª…ì‹œ</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="ttl-panel" role="tabpanel">
                            <div class="alert alert-secondary py-2 small mb-2 d-flex justify-content-between align-items-center">
                                <span><i class="fa-solid fa-file-lines me-2"></i>"KODVì˜ ì „ì²´ ì§€ì‹ê·¸ë˜í”„(Schema + Instance) ì†ŒìŠ¤ ì½”ë“œì…ë‹ˆë‹¤. (ì´ 88,918 Triples)"</span>
                                <span id="ttl-loading" class="text-primary fw-bold" style="display:none;">
                                    <i class="fa-solid fa-spinner fa-spin me-1"></i>Loading...
                                </span>
                            </div>
                            
                            <div class="position-relative">
                                <pre id="ttl-content" class="bg-dark text-light p-3 rounded border border-secondary shadow-sm" 
                                     style="height: 600px; overflow-y: auto; font-size: 0.85rem; line-height: 1.5;">
(íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ 'Ontology Example' íƒ­ì„ í´ë¦­í•˜ì„¸ìš”...)
                                </pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="map"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        // [ì„¤ì •] ë°ì´í„° ì†ì„±ë³„ ë¼ë²¨/ë‹¨ìœ„/ì•„ì´ì½˜ ë§¤í•‘ (19ì¢… ì „ì²´ + ë©”íƒ€ë°ì´í„°)
            const ATTR_MAP = {
                // [1. ê¸‰ìˆ˜ ì¸êµ¬ ì •ë³´]
                'population': { label: 'ì¸êµ¬', unit: 'ëª…', icon: 'fa-users', color: 'primary' },
                'waterSupplyRate': { label: 'ê¸‰ìˆ˜ìœ¨', unit: '%', icon: 'fa-faucet', color: 'primary' },
                'waterSupplyPopulation': { label: 'ê¸‰ìˆ˜ì¸êµ¬', unit: 'ëª…', icon: 'fa-user-check', color: 'primary' },

                // [2. ë…¸ì¶œë„]
                'droughtSeverityAvg': { label: 'í‰ê· ê°€ë­„ì‹¬ë„', unit: '', icon: 'fa-sun', color: 'warning' },
                'droughtFrequency': { label: 'ê°€ë­„ë¹ˆë„', unit: 'íšŒ', icon: 'fa-calendar-day', color: 'warning' },
                'droughtExposureScore': { label: 'ë…¸ì¶œë„', unit: 'ì ', icon: 'fa-chart-line', color: 'warning' },
                'exposureCoefficient': { label: 'ë…¸ì¶œë„ê³„ìˆ˜', unit: '', icon: 'fa-calculator', color: 'warning' },

                // [3. ë¯¼ê°ë„]
                'domesticWaterUsage': { label: 'ìƒí™œìš©ìˆ˜', unit: 'ã¥', icon: 'fa-house-chimney', color: 'success' },
                'industrialWaterUsage': { label: 'ê³µì—…ìš©ìˆ˜', unit: 'ã¥', icon: 'fa-industry', color: 'success' },
                'livingIndustrialWaterUsage': { label: 'ìƒÂ·ê³µìš©ìˆ˜', unit: 'ã¥', icon: 'fa-faucet-drip', color: 'success' },
                'sensitivityCoefficient': { label: 'ë¯¼ê°ë„ê³„ìˆ˜', unit: '', icon: 'fa-calculator', color: 'success' },

                // [4. ë³´ì¡°ìˆ˜ì›]
                'reservoirCapacity': { label: 'ì €ìˆ˜ì§€ìš©ëŸ‰', unit: 'ì²œã¥', icon: 'fa-water', color: 'info' },
                'groundwaterAvailable': { label: 'ì§€í•˜ìˆ˜ëŸ‰', unit: 'ì²œã¥', icon: 'fa-arrow-up-from-bracket', color: 'info' },
                'auxWaterSourceCapacity': { label: 'ë³´ì¡°ìˆ˜ì›ëŠ¥ë ¥', unit: '', icon: 'fa-hand-holding-droplet', color: 'info' },
                'auxWaterSourceCoefficient': { label: 'ë³´ì¡°ìˆ˜ì›ê³„ìˆ˜', unit: '', icon: 'fa-calculator', color: 'info' },

                // [5. ëŒ€ì‘ëŠ¥ë ¥]
                'waterSupplyAvailableDays': { label: 'ê³µê¸‰ê°€ëŠ¥ì¼ìˆ˜', unit: 'ì¼', icon: 'fa-calendar-check', color: 'secondary' },
                'responseCapacityCoefficient': { label: 'ëŒ€ì‘ëŠ¥ë ¥ê³„ìˆ˜', unit: '', icon: 'fa-calculator', color: 'secondary' },

                // [6. ì·¨ì•½ì„±]
                'vulnerabilityScore': { label: 'ì·¨ì•½ì„±ì ìˆ˜', unit: 'ì ', icon: 'fa-triangle-exclamation', color: 'danger' },
                'vulnerabilityRating': { label: 'ë“±ê¸‰', unit: '', icon: 'fa-layer-group', color: 'danger' },

                // [ê¸°íƒ€]
                'val': { label: 'ê°’', unit: '', icon: 'fa-check', color: 'secondary' },
                'count': { label: 'ê°œìˆ˜', unit: 'ê°œ', icon: 'fa-list-ol', color: 'dark' }
            };
        
        //ì§€ë„ ìƒì„± (ëŒ€í•œë¯¼êµ­ ì¤‘ì‹¬, ì¶•ì†Œë§Œ ì œí•œí•˜ê³  ì´ë™ì€ ììœ ë¡­ê²Œ)
        var map = L.map('map', {
            // maxBounds ì‚­ì œ: ì´ì œ ì§€ë„ë¥¼ ë§ˆìŒê» ëŒì–´ì„œ ì›€ì§ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            minZoom: 7, // ë„ˆë¬´ ì‘ê²Œ ì¶•ì†Œí•´ì„œ ì§€êµ¬ê°€ ë‹¤ ë³´ì´ëŠ” ê±´ ë°©ì§€
            maxZoom: 18 // ìµœëŒ€ í™•ëŒ€ ì œí•œ
        }).setView([36.5, 127.5], 7);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', { 
            attribution: '&copy; CARTO', 
            maxZoom: 19 
        }).addTo(map);

        var sidoLayer, sigLayer, emdLayer, dbCodes = [], highlightLayer;
        var lastSparql = "";

        function showLoading(show, text="ë¡œë”© ì¤‘...") { 
            $('#loading .mt-3').text(text);
            $('#loading').css('display', show ? 'block' : 'none'); 
        }

        function fixName(name) {
            if (name === "ê°•ì›ë„") return "ê°•ì›íŠ¹ë³„ìì¹˜ë„";
            if (name === "ì „ë¼ë¶ë„") return "ì „ë¶íŠ¹ë³„ìì¹˜ë„";
            return name;
        }

        function getProps(feature) {
            var p = feature.properties;
            var code = String(p.CTPRVN_CD || p.CTP_RVN_CD || p.SIG_CD || p.sig_cd || p.adm_cd2 || p.adm_cd || "");
            var name = p.CTP_KOR_NM || p.ctp_kor_nm || p.SIG_KOR_NM || p.sig_kor_nm || p.adm_nm || p.name || "ì´ë¦„ì—†ìŒ";
            return { code: code, name: fixName(name) };
        }

        showLoading(true);
        $.getJSON("/api/existing-codes", function(codes) {
            dbCodes = codes;
            $.getJSON("{{ url_for('static', filename='sido.json') }}", function(data) {
                sidoLayer = L.geoJson(data, { style: styleSido, onEachFeature: onEachRegion });
                sidoLayer.addTo(map);
                $.getJSON("{{ url_for('static', filename='sig.json') }}", function(data) {
                    sigLayer = L.geoJson(data, { style: styleSig, onEachFeature: onEachRegion });
                    $.getJSON("{{ url_for('static', filename='emd.geojson') }}", function(data) {
                        emdLayer = L.geoJson(data, { style: styleEmd, onEachFeature: onEachRegion });
                        showLoading(false);
                        updateLayer();
                    });
                });
            });
        });

        function styleSido(f) { return { color: "#2c3e50", weight: 2, opacity: 0.8, fillColor: "transparent", fillOpacity: 0 }; }
        function styleSig(f) { return { color: "#5e72e4", weight: 1.5, opacity: 0.6, fillColor: "#5e72e4", fillOpacity: 0.05 }; }
        function styleEmd(f) { return { color: "#fb6340", weight: 1, opacity: 0.8, fillColor: "#fb6340", fillOpacity: 0.1 }; }

        // 1. ê° ì§€ì—­ ë ˆì´ì–´ ì„¤ì • í•¨ìˆ˜ (L1 í˜¸ë²„ ê°œì„  & ê¸°ëŠ¥ í†µí•©)
            function onEachRegion(feature, layer) {
                var props = getProps(feature);
                var code = String(props.code);
                var name = props.name;

                layer.bindTooltip(`<b>${name}</b>`, { direction: "top", sticky: true });

                // [ìˆ˜ì • 1] í˜¸ë²„ ìŠ¤íƒ€ì¼ ê°œì„  (L1ë„ ë©´ ìƒ‰ì¹  + ì•ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°)
                layer.on('mouseover', function () {
                    this.setStyle({
                        fillOpacity: 0.5,
                        weight: 3,
                        color: "#555",       // í…Œë‘ë¦¬ ì§„íšŒìƒ‰
                        fillColor: "#888"    // ë©´ íšŒìƒ‰ (ê¸°ì¡´ ìƒ‰ìƒ ìœ„ì— ë®ì–´ì”Œì›€)
                    });

                    // â˜… í•µì‹¬: í˜¸ë²„ëœ ì§€ì—­ì„ ê°€ì¥ ìœ„ë¡œ ì˜¬ë ¤ì„œ í…Œë‘ë¦¬ ê²¹ì¹¨ í•´ê²°
                    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                        this.bringToFront();
                    }
                });

                layer.on('mouseout', function () {
                    var defStyle;
                    if (code.length === 2) defStyle = styleSido;
                    else if (code.length === 5) defStyle = styleSig;
                    else defStyle = styleEmd;

                    if (typeof defStyle === 'function') {
                        this.setStyle(defStyle());
                    } else {
                        this.setStyle({ fillOpacity: 0.2, weight: 1, color: "white" });
                    }
                });

                // í´ë¦­ ì´ë²¤íŠ¸ (íŒì—…)
                layer.on('click', function (e) {
                    if (!code) return;

                    showLoading(true, "ìƒì„¸ ì •ë³´ ì¡°íšŒ ì¤‘...");
                    map.panTo(e.latlng, { animate: true, duration: 0.8 });

                    // API í˜¸ì¶œ
                    $.ajax({
                        url: "/api/data/" + code,
                        dataType: 'json',
                        success: function (res) {
                            showLoading(false);
                            var content = buildPopupHtml(res, name, code, e.latlng);
                            layer.bindPopup(content, { maxWidth: 800 }).openPopup();
                        },
                        error: function () {
                            showLoading(false);
                            // Fallback
                            var dummyRes = { status: "fail" };
                            var content = buildPopupHtml(dummyRes, name, code, e.latlng);
                            layer.bindPopup(content, { maxWidth: 800 }).openPopup();
                        }
                    });
                });

                layer.regionCode = code;
            }

            // 2. íŒì—… HTML ìƒì„± í•¨ìˆ˜ (ë“±ê¸‰ë³„ ìƒ‰ìƒ ì ìš©)
            function buildPopupHtml(res, name, code, latlng) {
                var level = (code.length === 2) ? 'L1' : (code.length === 5) ? 'L2' : 'L3';

                var levelBadge = (level === 'L1') ? '<span class="badge bg-dark ms-2" style="font-size:0.7rem;">ê´‘ì—­</span>' :
                    (level === 'L2') ? '<span class="badge bg-secondary ms-2" style="font-size:0.7rem;">ê¸°ì´ˆ</span>' : '';

                var zoomBtn = "";
                if (level !== 'L3') {
                    zoomBtn = `<button class="btn btn-sm btn-outline-primary w-100 mt-3 shadow-sm fw-bold" onclick="zoomToRegion(${latlng.lat}, ${latlng.lng}, '${level}')">
                <i class="fa-solid fa-magnifying-glass-plus me-1"></i>ìƒì„¸ ì§€ì—­ íƒìƒ‰
            </button>`;
                }

                var d = (res.status === "success") ? res.data : {};
                var finalName = (d.label && d.label.value) ? d.label.value : name;
                var desc = (d.desc && d.desc.value) ? d.desc.value : "Wikidataì— ìƒì„¸ ì„¤ëª… ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.";
                var score = d.vulScore ? `${parseFloat(d.vulScore.value).toFixed(2)}ì ` : "";

                // [ìˆ˜ì • 2] ë“±ê¸‰ë³„ ìƒ‰ìƒ ë° ë¼ë²¨ ì²˜ë¦¬ ë¡œì§
                var gradeRaw = d.gradeLabel ? d.gradeLabel.value : ""; // ì˜ˆ: "I ë“±ê¸‰", "IV ë“±ê¸‰"
                var gradeObj = { label: "ì •ë³´ì—†ìŒ", class: "bg-secondary", text: "text-muted", border: "border-secondary" };

                if (gradeRaw.includes("I") && !gradeRaw.includes("II") && !gradeRaw.includes("V")) { // I (ê´€ì‹¬)
                    gradeObj = { label: "I (ê´€ì‹¬)", class: "bg-success", text: "text-success", border: "border-success" };
                } else if (gradeRaw.includes("II") && !gradeRaw.includes("III")) { // II (ì£¼ì˜)
                    gradeObj = { label: "II (ì£¼ì˜)", class: "bg-warning text-dark", text: "text-warning", border: "border-warning" };
                } else if (gradeRaw.includes("III")) { // III (ê²½ê³„)
                    gradeObj = { label: "III (ê²½ê³„)", class: "bg-orange", text: "text-orange", border: "border-orange" }; // ë³„ë„ style í•„ìš”
                } else if (gradeRaw.includes("IV")) { // IV (ì‹¬ê°)
                    gradeObj = { label: "IV (ì‹¬ê°)", class: "bg-danger", text: "text-danger", border: "border-danger" };
                } else if (gradeRaw.includes("V")) { // V (ë§¤ìš°ì‹¬ê°)
                    gradeObj = { label: "V (ë§¤ìš°ì‹¬ê°)", class: "bg-dark-red", text: "text-dark-red", border: "border-dark-red" }; // ë³„ë„ style í•„ìš”
                } else if (gradeRaw) {
                    gradeObj = { label: gradeRaw, class: "bg-secondary", text: "text-secondary", border: "border-secondary" };
                }

                var gradeBadge = gradeRaw ? `<span class="badge ${gradeObj.class} ms-1 shadow-sm">${gradeObj.label}</span>` : "";

                // ì´ë¯¸ì§€ HTML ìƒì„±
                var noImagePlaceholder = "https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/No_image_available.svg/300px-No_image_available.svg.png";
                var rawImgUrl = (d.image && d.image.value) ? d.image.value : "";
                var imageHtml = "";

                if (!rawImgUrl || rawImgUrl === noImagePlaceholder) {
                    imageHtml = `
                <div class="d-flex flex-column justify-content-center align-items-center bg-light border rounded mb-3" style="height: 180px; text-align: center;">
                    <i class="fa-regular fa-image fa-2x text-secondary mb-2 opacity-50"></i>
                    <span class="text-secondary small fw-bold">ì´ë¯¸ì§€ ë¯¸ë³´ìœ </span>
                    <span class="text-muted" style="font-size: 0.7rem;">(Wikidata Source)</span>
                </div>`;
                } else {
                    imageHtml = `
                <div class="shadow-sm rounded overflow-hidden mb-3 position-relative" style="height: 180px;">
                    <img src="${rawImgUrl}" class="w-100 h-100" style="object-fit: cover; transition: transform 0.3s;" alt="${finalName}">
                    <div class="position-absolute bottom-0 end-0 bg-dark bg-opacity-50 text-white px-2 py-1 small" style="font-size:0.7rem; border-top-left-radius: 5px;">
                        <i class="fa-brands fa-wikipedia-w"></i> Wikidata
                    </div>
                </div>`;
                }

                // [ì¢Œì¸¡ íŒ¨ë„]
                var leftPanel = `
            <div class="p-3 bg-white" style="width: 300px;">
                <div class="d-flex align-items-center mb-3 pe-3">
                    <h5 class="fw-bold text-dark m-0 me-auto text-truncate">
                        <i class="fa-solid fa-location-dot text-primary me-2"></i>${finalName}
                    </h5>
                    ${gradeBadge} ${levelBadge}
                </div>
                
                ${imageHtml}
                
                <div class="mb-3">
                    <div class="text-muted small mb-1 fw-bold"><i class="fa-solid fa-quote-left me-1 text-primary"></i>ê°œìš”</div>
                    <p class="text-secondary small mb-0 text-truncate-3" style="line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">
                        ${desc}
                    </p>
                </div>

                <div class="d-flex justify-content-between align-items-center bg-light p-2 rounded mb-3 border">
                    <span class="small text-muted"><i class="fa-solid fa-barcode me-1"></i>í–‰ì •ì½”ë“œ</span>
                    <span class="font-monospace fw-bold text-dark">${code}</span>
                </div>

                ${score ? `<div class="d-flex justify-content-between align-items-center bg-light p-2 rounded mb-3 border ${gradeObj.border} border-opacity-50">
                    <span class="small ${gradeObj.text} fw-bold"><i class="fa-solid fa-chart-line me-1"></i>ì·¨ì•½ì„± ì ìˆ˜</span>
                    <span class="fw-bold ${gradeObj.text}">${score}</span>
                </div>` : ""}

                <div class="d-grid gap-2">
                    <a href="${d.wikiURI ? d.wikiURI.value : '#'}" target="_blank" class="btn btn-sm btn-dark shadow-sm">
                        <i class="fa-brands fa-wikipedia-w me-1"></i>ìœ„í‚¤ë°ì´í„° ì›ë¬¸ ë³´ê¸°
                    </a>
                    ${zoomBtn}
                </div>
            </div>`;

                // [ìš°ì¸¡ íŒ¨ë„] (L3 ì „ìš©)
                var rightPanel = "";
                if (level === 'L3' && res.status === "success") {
                    const groups = [
                        { name: "ê¸‰ìˆ˜ ì¸êµ¬ ì •ë³´", color: "text-primary", keys: ['population', 'waterSupplyRate', 'waterSupplyPopulation'] },
                        { name: "ë…¸ì¶œë„ (Exposure)", color: "text-warning", keys: ['droughtSeverityAvg', 'droughtFrequency', 'droughtExposureScore', 'exposureCoefficient'] },
                        { name: "ë¯¼ê°ë„ (Sensitivity)", color: "text-success", keys: ['domesticWaterUsage', 'industrialWaterUsage', 'livingIndustrialWaterUsage', 'sensitivityCoefficient'] },
                        { name: "ë³´ì¡°ìˆ˜ì› (Auxiliary)", color: "text-info", keys: ['reservoirCapacity', 'groundwaterAvailable', 'auxWaterSourceCapacity', 'auxWaterSourceCoefficient'] },
                        { name: "ëŒ€ì‘ëŠ¥ë ¥ (Response)", color: "text-secondary", keys: ['waterSupplyAvailableDays', 'responseCapacityCoefficient'] }
                    ];

                    const fmt = (val) => val ? Number(val).toLocaleString() : '-';
                    const getVal = (key) => d[key] ? d[key].value : null;

                    let tableRows = "";
                    groups.forEach(g => {
                        tableRows += `<tr class="bg-light border-bottom"><td colspan="2" class="fw-bold ${g.color} pt-2 pb-1 ps-2 small"><i class="fa-solid fa-chevron-right me-1" style="font-size:0.7rem;"></i>${g.name}</td></tr>`;
                        g.keys.forEach(k => {
                            let info = ATTR_MAP[k] || { label: k, unit: '' };
                            let val = getVal(k);
                            if (val) {
                                if (!isNaN(val) && val.indexOf('.') !== -1) val = parseFloat(val).toFixed(2);
                                else val = Number(val).toLocaleString();
                            } else {
                                val = "-";
                            }

                            tableRows += `
                        <tr class="border-bottom-light">
                            <td class="text-secondary ps-3 py-1"><i class="fa-solid ${info.icon} me-1 text-muted" style="font-size: 0.8em; width:15px;"></i>${info.label}</td>
                            <td class="text-end pe-2 py-1 font-monospace text-dark">${val} <span class="text-muted" style="font-size:0.8em;">${info.unit}</span></td>
                        </tr>`;
                        });
                    });

                    // ë“±ê¸‰ë³„ ìƒ‰ìƒ ì ìš©ëœ í‘¸í„°
                    let tableFooter = `
                <tr class="${gradeObj.class} bg-opacity-10 border-top ${gradeObj.border}">
                    <td class="fw-bold ${gradeObj.text} ps-2 py-2"><i class="fa-solid fa-layer-group me-1"></i>ìµœì¢… ë“±ê¸‰</td>
                    <td class="text-end fw-bold ${gradeObj.text} pe-2 py-2">${gradeObj.label}</td>
                </tr>`;

                    rightPanel = `
                <div class="border-start bg-white d-flex flex-column" style="width: 340px; max-height: 550px;">
                    <div class="alert alert-primary m-0 rounded-0 border-0 border-bottom fw-bold py-2 px-3 pe-5">
                        <i class="fa-solid fa-droplet me-2"></i>KODV ìƒì„¸ ë¶„ì„ ë°ì´í„°
                    </div>
                    <div class="overflow-auto flex-grow-1" style="max-height: 500px;">
                        <table class="table table-sm table-borderless small mb-0 w-100">
                            <tbody>${tableRows}${tableFooter}</tbody>
                        </table>
                    </div>
                    <div class="bg-light text-center py-1 border-top text-muted" style="font-size: 0.7rem;">
                        ë°ì´í„° ì¶œì²˜: KODV Knowledge Graph
                    </div>
                </div>`;
                }

                return `<div class="d-flex rounded overflow-hidden shadow">${leftPanel}${rightPanel}</div>`;
            }

        function handleEnter(e) { if(e.key === 'Enter') askAI(); }
        function askAI() {
            var q = $('#searchInput').val(); if(!q) return alert("ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”!");
            showLoading(true, "AIê°€ ë¶„ì„ ì¤‘...");
            $('#ai-result-panel').hide();
            if(highlightLayer) map.removeLayer(highlightLayer);
            $.ajax({
                url: '/api/ask', type: 'POST', contentType: 'application/json', data: JSON.stringify({ question: q }),
                success: function(res) {
                    showLoading(false);
                    if(res.status==='success') { lastSparql=res.sparql; displayAIResults(res.data); }
                    else alert("AI ì˜¤ë¥˜: "+res.message);
                },
                error: function(){ showLoading(false); alert("ì„œë²„ ì˜¤ë¥˜"); }
            });
        }

    // [ìˆ˜ì • v2] GeoJSON ê²½ë¡œ ë³µêµ¬ ë° ì†ì„± ë§¤ì¹­ ìˆ˜ì •
    function displayAIResults(data) {
        var html = '<div class="list-group list-group-flush">';
        var codes = [];

        if (!data || data.length === 0) {
            $('#ai-content').html('<div class="text-center text-muted p-3">ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>');
            $('#ai-result-panel').show();
            return;
        }

        // [ìˆ˜ì •] ë””ë²„ê¹… ë¡œê·¸ê°€ ì¶”ê°€ëœ ì§€ë„ í•˜ì´ë¼ì´íŠ¸ ë¡œì§
        if (codes.length > 0) {
            if (window.highlightLayer) {
                map.removeLayer(window.highlightLayer);
            }

            $.getJSON("/static/emd.geojson", function (geoData) {
                var filtered = { type: "FeatureCollection", features: [] };

                // ë§¤ì¹­ëœ ì½”ë“œë“¤ì„ ì¶”ì í•˜ê¸° ìœ„í•œ ì§‘í•©
                var matchedCodes = new Set();

                filtered.features = geoData.features.filter(f => {
                    // GeoJSONì˜ ì½”ë“œ (ì—¬ê¸°ì„œ adm_cd2 ì¸ì§€ adm_cd ì¸ì§€ í™•ì¸ ì¤‘ìš”)
                    var geoCode = String(f.properties.adm_cd2 || f.properties.adm_cd || "");

                    if (codes.includes(geoCode)) {
                        matchedCodes.add(geoCode); // ë§¤ì¹­ ì„±ê³µ ê¸°ë¡
                        return true;
                    }
                    return false;
                });

                // [ë””ë²„ê¹…] ë§¤ì¹­ ì‹¤íŒ¨í•œ ì§€ì—­ ì½˜ì†”ì— ê²½ê³  ì¶œë ¥
                codes.forEach(c => {
                    if (!matchedCodes.has(c)) {
                        console.warn(`âš ï¸ ë§¤ì¹­ ì‹¤íŒ¨: ê²€ìƒ‰ê²°ê³¼ ì½”ë“œ [${c}]ê°€ GeoJSON ì§€ë„ íŒŒì¼ì— ì—†ìŠµë‹ˆë‹¤.`);
                        console.log(`   -> íŒíŠ¸: GeoJSONì˜ ì½”ë“œëŠ” 8ìë¦¬ì¸ë° ê²€ìƒ‰ê²°ê³¼ëŠ” 10ìë¦¬ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                    }
                });

                if (filtered.features.length > 0) {
                    window.highlightLayer = L.geoJson(filtered, {
                        style: { color: "#dc3545", weight: 3, fillColor: "#dc3545", fillOpacity: 0.4 },
                        onEachFeature: function (feature, layer) {
                            layer.regionCode = String(feature.properties.adm_cd2 || feature.properties.adm_cd);
                            if (feature.properties.emd_kor_nm) {
                                layer.bindTooltip(feature.properties.emd_kor_nm);
                            }
                        }
                    }).addTo(map);

                    // [ìˆ˜ì •] ì—¬ê¸°ë„ maxZoom ì ìš© (ì „ì²´ ë·° ì¡ì„ ë•Œë„ ë„ˆë¬´ í™•ëŒ€ë˜ì§€ ì•Šê²Œ)
                    map.fitBounds(window.highlightLayer.getBounds(), { maxZoom: 11 });
                } else {
                    console.error("ê²€ìƒ‰ ê²°ê³¼ ì½”ë“œëŠ” ìˆëŠ”ë°, ì§€ë„ì—ì„œ í•˜ë‚˜ë„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ì½”ë“œ í¬ë§· í™•ì¸ í•„ìš”)");
                }
            }).fail(function () {
                console.log("GeoJSON ë¡œë“œ ì‹¤íŒ¨");
            });
        }

        data.forEach(function (item, index) {
            // 1. ì´ë¦„ ë° ì½”ë“œ ì¶”ì¶œ
            // nameì´ ì—†ìœ¼ë©´ region, label ìˆœìœ¼ë¡œ ì°¾ìŒ
            var name = item.name ? item.name.value : (item.region ? item.region.value : (item.label ? item.label.value : "ì§€ì—­ëª… ì—†ìŒ"));
            var code = item.code ? item.code.value : "";
            if (code) codes.push(code);

            // 2. ì†ì„± ë°°ì§€ ìƒì„±
            var badgesHtml = "";
            Object.keys(item).forEach(function (key) {
                // ì‹œê°í™”ì—ì„œ ì œì™¸í•  ë©”íƒ€ë°ì´í„°ë“¤
                if (['name', 'region', 'label', 'code', 'geometry', 'geom'].includes(key)) return;

                var val = item[key].value;
                // ?val ì²˜ëŸ¼ ì¼ë°˜ ë³€ìˆ˜ëª…ì´ ì˜¤ë©´ 'ê°’'ìœ¼ë¡œ í‘œì‹œë˜ì§€ë§Œ, app.py ìˆ˜ì • í›„ì—” ì •ìƒ ì‘ë™í•¨
                var mapInfo = ATTR_MAP[key] || { label: key, unit: '', icon: 'fa-tag', color: 'secondary' };

                if (!isNaN(val) && val.length > 0) {
                    if (val.indexOf('.') !== -1) val = parseFloat(val).toFixed(2);
                    val = Number(val).toLocaleString();
                }

                badgesHtml += `
                    <span class="badge bg-${mapInfo.color} bg-opacity-10 text-${mapInfo.color} border border-${mapInfo.color} me-1 mb-1">
                        <i class="fa-solid ${mapInfo.icon} me-1"></i>${mapInfo.label}: ${val}${mapInfo.unit}
                    </span>`;
            });

            // 3. ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ìƒì„±
            // onclickì—ì„œ ë¬¸ìì—´ ë”°ì˜´í‘œ ì²˜ë¦¬ë¥¼ ìœ„í•´ escape ì£¼ì˜
            html += `
                <a href="#" class="list-group-item list-group-item-action py-3" onclick="moveToRegion('${code}'); return false;">
                    <div class="d-flex w-100 justify-content-between align-items-center mb-1">
                        <h6 class="mb-0 fw-bold text-dark">
                            <i class="fa-solid fa-location-dot text-danger me-2"></i>${name}
                        </h6>
                        <small class="text-muted font-monospace">${code}</small>
                    </div>
                    <div class="mt-1">
                        ${badgesHtml}
                    </div>
                </a>
            `;
        });

        html += '</div>';

        // SPARQL ë³´ê¸° ë²„íŠ¼
        html += `
            <div class="p-3 border-top bg-light">
                <button class="btn btn-sm btn-outline-secondary w-100" onclick="showSparqlModal()">
                    <i class="fa-solid fa-code me-1"></i>ìƒì„±ëœ SPARQL ë³´ê¸°
                </button>
            </div>`;

        $('#ai-content').html(html);
        $('#ai-result-panel').show();

        // 4. [ìˆ˜ì •] ì§€ë„ í•˜ì´ë¼ì´íŠ¸ ë¡œì§ (ë™ì  ë¡œë”© + getProps í™œìš©)
        if (codes.length > 0) {
            if (window.highlightLayer) {
                map.removeLayer(window.highlightLayer);
            }

            // ì²« ë²ˆì§¸ ê²°ê³¼ ì½”ë“œì˜ ê¸¸ì´ë¡œ ë ˆë²¨ íŒë‹¨ (ëª¨ë“  ê²°ê³¼ê°€ ê°™ì€ ë ˆë²¨ì´ë¼ê³  ê°€ì •)
            var firstCode = codes[0];
            var targetGeoJson = "";

            // ì‹œë„(2ìë¦¬) -> sido.json / ì‹œêµ°êµ¬(5ìë¦¬) -> sig.json / ìë©´ë™(ê¸°íƒ€) -> emd.geojson
            if (firstCode.length === 2) {
                targetGeoJson = "/static/sido.json";
            } else if (firstCode.length === 5) {
                targetGeoJson = "/static/sig.json";
            } else {
                targetGeoJson = "/static/emd.geojson";
            }

            // ì„ íƒëœ GeoJSON íŒŒì¼ ë¡œë”©
            $.getJSON(targetGeoJson, function (geoData) {
                var filtered = { type: "FeatureCollection", features: [] };

                filtered.features = geoData.features.filter(f => {
                    // â˜… í•µì‹¬: getProps í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•ˆì „í•˜ê²Œ ì½”ë“œ ì¶”ì¶œ
                    var props = getProps(f);
                    var c = String(props.code);
                    return codes.includes(c);
                });

                if (filtered.features.length > 0) {
                    window.highlightLayer = L.geoJson(filtered, {
                        style: { color: "#dc3545", weight: 3, fillColor: "#dc3545", fillOpacity: 0.4 },
                        onEachFeature: function (feature, layer) {
                            // ì—¬ê¸°ë„ getProps ì‚¬ìš© (í´ë¦­ ì´ë™ì„ ìœ„í•œ ì½”ë“œ ì‹¬ê¸°)
                            var props = getProps(feature);
                            layer.regionCode = String(props.code);

                            // íˆ´íŒ
                            if (props.name) {
                                layer.bindTooltip(props.name);
                            }
                        }
                    }).addTo(map);

                    // [Smooth UX ìµœì í™”] ì´ë™ ë° ì¤Œ
                    var targetBounds = window.highlightLayer.getBounds();
                    var targetCenter = targetBounds.getCenter();

                    // ë ˆë²¨ë³„ ì ì • ì¤Œ ì œí•œ (ì‹œë„ëŠ” ë©€ë¦¬, ìë©´ë™ì€ ê°€ê¹Œì´)
                    var maxZoomLimit = (firstCode.length === 2) ? 8 : (firstCode.length === 5) ? 9 : 11;

                    var targetZoom = map.getBoundsZoom(targetBounds, false, [50, 50]);
                    if (targetZoom > maxZoomLimit) targetZoom = maxZoomLimit;

                    setTimeout(() => {
                        map.flyTo(targetCenter, targetZoom, { duration: 1.5, easeLinearity: 0.25 });
                    }, 100);

                } else {
                    console.error("ë§¤ì¹­ ì‹¤íŒ¨: " + targetGeoJson + " ì—ì„œ ì½”ë“œë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                }
            }).fail(function () {
                console.log("GeoJSON ë¡œë“œ ì‹¤íŒ¨: " + targetGeoJson + " ê²½ë¡œë¥¼ í™•ì¸í•˜ì„¸ìš”.");
            });
        }
    }

    // [ìˆ˜ì •] ë¦¬ìŠ¤íŠ¸ í´ë¦­ ì‹œ ì´ë™ í•¨ìˆ˜ (ë ˆë²¨ë³„ ì¤Œ ì ìš©)
        function moveToRegion(targetCode) {
            if (!window.highlightLayer) return;

            var foundLayer = null;
            window.highlightLayer.eachLayer(function (layer) {
                if (layer.regionCode === targetCode) {
                    foundLayer = layer;
                }
            });

            if (foundLayer) {
                // ì½”ë“œ ê¸¸ì´ì— ë”°ë¼ ì¤Œ ë ˆë²¨ ë™ì  ê²°ì •
                // L1(2ìë¦¬) -> 8, L2(5ìë¦¬) -> 9, L3(ë‚˜ë¨¸ì§€) -> 11
                var targetZoom = 11;
                if (targetCode.length === 2) targetZoom = 8;
                else if (targetCode.length === 5) targetZoom = 9;

                // flyTo ì‚¬ìš© (ë¶€ë“œëŸ¬ìš´ ì´ë™)
                map.flyTo(foundLayer.getBounds().getCenter(), targetZoom, {
                    duration: 1.2,
                    easeLinearity: 0.25
                });

                // ì‹œê°ì  í”¼ë“œë°± (ë°˜ì§ì„)
                var originalStyle = { color: "#dc3545", weight: 3, fillColor: "#dc3545", fillOpacity: 0.4 };
                foundLayer.setStyle({ fillOpacity: 0.8, weight: 5, color: "#ff0000" });

                setTimeout(() => {
                    if (window.highlightLayer) foundLayer.setStyle(originalStyle);
                }, 800);
            } else {
                console.log("ì§€ë„ì—ì„œ í•´ë‹¹ ì§€ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
        }

        function showSparqlModal() { if(!lastSparql) return; $('#sparql-code').text(lastSparql); new bootstrap.Modal(document.getElementById('sparqlModal')).show(); }
        function showHelpModal() { new bootstrap.Modal(document.getElementById('helpModal')).show(); }
        
        // â˜… [ì‹ ê·œ] ì „ë¬¸ê°€ ì½˜ì†” ëª¨ë‹¬
        function showConsoleModal() { new bootstrap.Modal(document.getElementById('consoleModal')).show(); }

        // â˜… [ì‹ ê·œ] ì „ë¬¸ê°€ ì½˜ì†” ì‹¤í–‰
        function runConsoleQuery() {
            var q = $('#console-input').val(); if(!q) return alert("ì¿¼ë¦¬ ì…ë ¥");
            var btn = $('#consoleModal button i'); btn.attr('class', 'fa-solid fa-spinner fa-spin');
            $.ajax({
                url: '/api/sparql', type: 'POST', contentType: 'application/json', data: JSON.stringify({ query: q }),
                success: function(res) {
                    btn.attr('class', 'fa-solid fa-play');
                    if(res.status==='success') {
                        var h='<tr>'; res.vars.forEach(v=>{h+=`<th>${v}</th>`}); h+='</tr>'; $('#console-result-table thead').html(h);
                        var b=''; 
                        if(res.data.length===0) b=`<tr><td colspan="${res.vars.length}" class="text-center text-muted">ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
                        else {
                            res.data.forEach(r=>{ b+='<tr>'; res.vars.forEach(v=>{ var val=r[v]?r[v].value:""; if(val.startsWith("http")) val=`<a href="${val}" target="_blank">URI</a>`; b+=`<td>${val}</td>`; }); b+='</tr>'; });
                        }
                        $('#console-result-table tbody').html(b);
                    } else alert("Error: "+res.message);
                },
                error: function(){ btn.attr('class', 'fa-solid fa-play'); alert("Conn Error"); }
            });
        }

        window.zoomToRegion = function(lat, lng, level) {
            var z = (level === 'L1') ? 9 : 11;
            map.setView([lat, lng], z, { animate: true, duration: 1.5 });
        };

        function updateLayer() {
            var z = map.getZoom();
            var b = document.getElementById('level-name');
            if(sidoLayer) map.removeLayer(sidoLayer); if(sigLayer) map.removeLayer(sigLayer); if(emdLayer) map.removeLayer(emdLayer); if(highlightLayer) map.addLayer(highlightLayer);
            if(z<9) { if(sidoLayer) map.addLayer(sidoLayer); b.innerText = "ê´‘ì—­ (ì‹œë„)"; }
            else if(z>=9 && z<11) { if(sigLayer) map.addLayer(sigLayer); b.innerText = "ê¸°ì´ˆ (ì‹œêµ°êµ¬)"; }
            else { if(emdLayer) map.addLayer(emdLayer); b.innerText = "ìƒì„¸ (ìë©´ë™)"; }
        }
        map.on('zoomend', updateLayer);

        // [ìµœì í™”] í˜ì´ì§€ ë¡œë“œ ì‹œ TTL íŒŒì¼ ë°±ê·¸ë¼ìš´ë“œ ë¯¸ë¦¬ ì½ê¸° (Pre-loading)
        document.addEventListener("DOMContentLoaded", function() {
            const ttlContentBox = document.getElementById('ttl-content');
            const loadingText = document.getElementById('ttl-loading');
    
            // íŒŒì¼ ê²½ë¡œ (static í´ë” ë‚´ ì‹¤ì œ íŒŒì¼ëª…ìœ¼ë¡œ ìˆ˜ì • í•„ìš”)
            const filePath = '/static/KODV_KnowledgeGraph_Final.ttl';

            // 1. ë¡œë”© í‘œì‹œ í™œì„±í™” (í˜¹ì‹œ ì‚¬ìš©ìê°€ 0.1ì´ˆë§Œì— íƒ­ì„ ëˆ„ë¥¼ ê²½ìš°ë¥¼ ëŒ€ë¹„)
            if(loadingText) loadingText.style.display = 'inline-block';
            if(ttlContentBox) ttlContentBox.textContent = "Background loading in progress...";

            // 2. ë°±ê·¸ë¼ìš´ë“œ Fetch
            fetch(filePath)
                .then(response => {
                    if (!response.ok) throw new Error("File not found (" + response.status + ")");
                    return response.text();
                })
                .then(text => {
                    // 3. ìˆ¨ê²¨ì§„ íƒ­ì— ë¯¸ë¦¬ í…ìŠ¤íŠ¸ ì£¼ì… (DOM ë Œë”ë§ ë¹„ìš© ë¯¸ë¦¬ ì§€ë¶ˆ)
                    if(ttlContentBox) ttlContentBox.textContent = text;
                })
                .catch(err => {
                    if(ttlContentBox) ttlContentBox.textContent = "Error loading TTL: " + err.message;
                })
                .finally(() => {
                    // 4. ë¡œë”© í‘œì‹œ ìˆ¨ê¹€
                    if(loadingText) loadingText.style.display = 'none';
                });
        });
    </script>
</body>
</html>